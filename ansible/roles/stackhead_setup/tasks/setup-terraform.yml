---
- name: Create global Terraform folder
  file:
    path: "{{ stackhead__tf_root_folder }}"
    state: directory
    owner: stackhead
    group: stackhead
- name: Create system Terraform folder
  file:
    path: "{{ stackhead__system_tf_root_folder }}"
    state: directory
    owner: stackhead
    group: stackhead
- include_role:
    name: andrewrothstein.terraform
  vars:
    terraform_ver: 0.13.3

# Setup Terraform components of modules
- import_tasks: "../roles/stackhead_module_api/tasks_internal/terraform.yml"
- import_tasks: "../roles/config_terraform/tasks/generate-providers.yml"

# Initial run applying settings from Terraform files created above
- import_tasks: "../roles/config_terraform/tasks/execute.yml"
  vars:
    terraform_folder: "{{ stackhead__system_tf_root_folder }}"

- template:
    src: "{{ stackhead__templates }}/terraform/env.sh.j2"
    dest: "{{ stackhead__system_tf_root_folder }}/env.sh"
